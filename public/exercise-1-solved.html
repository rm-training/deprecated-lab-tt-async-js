<!doctype html>
<html lang="en">

<head>
  <title>Targeted Topics - Async JS</title>
  <meta charset="utf8" />
  <link href="/vendor/semantic-ui/semantic.min.css" rel="stylesheet" type="text/css" />
</head>

<body class="ui container">
  <h1>Exercise 1</h1>

  <h3>Part 1</h3>
  <p>Implement the "listenTo" function so that it:</p>

  <ul>
    <li>Takes two args, the element and the event...</li>
    <li>Returns a new promise</li>
    <li>Resolves when the event occurs</li>
    <li>Resolves to the event object</li>
    <li>Don't worry about rejection</li>
  </ul>

  <h6>Take note: this handles the event <em>once</em>... think about why that is.</h6>

  <h3>Part 2</h3>
  <p>Implement a "delay" function that:</p>

  <ul>
    <li>Accepts one argument, "ms" - the number of milliseconds to delay by</li>
    <li>Returns a promise that resolves after the specified timout</li>
  </ul>

  <p>
    Finally, use your "delay" function so that you remove the
    button from the page 5 seconds after the user clicks it.
    Try to do this by adding another callback to the chain.
  </p>


  <div id="primary-button" class="ui primary button">
    Click me...
  </div>

  <script>

    // write your solution here...
    function listenTo(el, event) {
      return new Promise((resolve, reject) => {
        el.addEventListener(event, e => {
          resolve(e);
        });
      });
    }

    function delay(ms) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve();
        }, ms);
      });
    }

    const button = document.getElementById('primary-button');

    const prom = listenTo(button, 'click').then((e) => {
        console.log('This element was clicked:', e.target);
      });

    prom.then(e => {
          // interesting...
          // this handler is immediately applied and triggered
          // bubbling at work!
          // I need to build in some delay to avoid a "double click"
          // ala: button click -> promise resolves -> handler added -> bubbles up -> body click
          return listenTo(document.body, 'click');
        })
        .then(() => {
          console.log('Body was clicked');
        })
        .then(() => {
          return delay(5000);
        })
        .then(() => {
          button.remove();
        });
  </script>

</body>

</html>